<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="admin">
    <select id="sales_day" parameterType="String" resultType="int">
        <![CDATA[
            select count(dt_num)
            from tb_detail as dt join tb_order as od
            on dt.od_num = od.od_num
            where DATE_FORMAT(od_date, '%Y-%m-%d') = DATE_FORMAT(now(), '%Y-%m-%d')
        ]]>
    </select>

    <select id="sales_month" parameterType="String" resultType="int">
        <![CDATA[
        select count(dt_num)
        from tb_detail as dt join tb_order as od
        on dt.od_num = od.od_num
        where DATE_FORMAT(od_date, '%Y-%m') = DATE_FORMAT(now(), '%Y-%m')
        ]]>
    </select>

    <select id="sales_year" parameterType="String" resultType="int">
        <![CDATA[
        select count(dt_num)
        from tb_detail as dt join tb_order as od
        on dt.od_num = od.od_num
        where DATE_FORMAT(od_date, '%Y') = DATE_FORMAT(now(), '%Y')
        ]]>
    </select>

    <select id="typeName" parameterType="String" resultType="String">
        SELECT gm_code
        FROM tb_game
        WHERE gm_code LIKE CONCAT('%',#{type},'%')
        ORDER BY gm_code DESC
        LIMIT 1
    </select>

    <insert id="gameInsert" parameterType="com.cafe24.nonchrono.dto.GameDTO">
        INSERT INTO tb_game (gm_code, gm_name, gm_price, gm_level, gm_category, gm_img)
        VALUES (#{gm_code}, #{gm_name}, #{gm_price}, #{gm_level}, #{gm_category}, #{gm_img})
    </insert>

    <select id="gameList" parameterType="String" resultType="com.cafe24.nonchrono.dto.GameDTO">
        SELECT gm_code, gm_name, gm_price, gm_category, gm_level
        FROM tb_game
        WHERE gm_code LIKE CONCAT('%',#{type},'%')
        ORDER BY gm_code ASC
    </select>

    <select id="revenue_day" resultType="int">
        select ifnull(sum(total), 0)
        from tb_order
        where date_format(od_date, '%Y-%m-%d') = date_format(now(), '%Y-%m-%d')
    </select>

    <select id="revenue_month" resultType="int">
        select ifnull(sum(total), 0)
        from tb_order
        where date_format(od_date, '%Y-%m') = date_format(now(), '%Y-%m')
    </select>

    <select id="revenue_year" resultType="int">
        select ifnull(sum(total), 0)
        from tb_order
        where date_format(od_date, '%Y') = date_format(now(), '%Y')
    </select>

    <select id="customer_day" resultType="int">
        select ifnull(count(*),0) as cnt
        from (
                 select distinct (mem_id)
                 from tb_order
                 where date_format(od_date, '%Y-%m-%d') = date_format(now(), '%Y-%m-%d')
             ) AA
    </select>

    <select id="customer_month" resultType="int">
        select ifnull(count(*),0) as cnt
        from (
                 select distinct (mem_id)
                 from tb_order
                 where date_format(od_date, '%Y-%m') = date_format(now(), '%Y-%m')
             ) AA
    </select>

    <select id="customer_year" resultType="int">
        select ifnull(count(*),0) as cnt
        from (
                 select distinct (mem_id)
                 from tb_order
                 where date_format(od_date, '%Y') = date_format(now(), '%Y')
             ) AA
    </select>

</mapper>