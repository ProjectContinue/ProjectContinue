<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="seller">
    <!-- 배송정책 등록하기 -->
    <insert id="dv_insert" parameterType="com.cafe24.nonchrono.dto.DeliveryDTO">
        INSERT INTO tb_delivery ( sl_id,  dv_how, dv_courier, dv_fee, dv_extrafee, dv_adr1, dv_adr2, dv_rffee, dv_exfee, dv_exadr1, dv_exadr2)
        VALUES ( #{sl_id}, #{dv_how}, #{dv_courier}, #{dv_fee}, #{dv_extrafee}, #{dv_adr1}, #{dv_adr2}, #{dv_rffee}, #{dv_exfee}, #{dv_exadr1}, #{dv_exadr2})
    </insert>


    <!-- 판마자별 배송정책 리스트 -->
    <select id="dv_list" resultType="com.cafe24.nonchrono.dto.DeliveryDTO">
        select dv_num ,sl_id ,dv_how ,dv_courier ,dv_fee ,dv_extrafee ,dv_adr1 ,dv_adr2 ,dv_rffee ,dv_exfee ,dv_exadr1 ,dv_exadr2
        from tb_delivery
        where sl_id = #{sl_id}
        ORDER BY dv_num DESC
    </select>

    <select id="list" parameterType="com.cafe24.nonchrono.dto.SellerDTO">
        SELECT sl_id, sl_pw, sl_name, sl_zip, sl_adr1, sl_adr2, sl_phone, sl_birth, sl_grade, sl_receive, sl_number, sl_bank, sl_bankcode
        FROM tb_seller
        ORDER BY sl_id
    </select>

    <select id="login" parameterType="com.cafe24.nonchrono.dto.SellerDTO" resultType="String">
        SELECT sl_grade
        FROM tb_seller
        WHERE sl_id = #{sl_id} AND sl_pw = #{sl_pw} AND sl_grade IN ('SVip', 'SGold', 'SSilver', 'SBronze', 'SNew');
    </select>

    <select id="check" resultType="com.cafe24.nonchrono.dto.SellerDTO">
        SELECT sl_id
        FROM tb_seller
    </select>

    <insert id="seller_insert" parameterType="com.cafe24.nonchrono.dto.SellerDTO">
        INSERT INTO tb_seller(sl_id, sl_pw, sl_name, sl_zip, sl_adr1, sl_adr2, sl_phone, sl_birth, sl_number, sl_bank, sl_bankcode)
        VALUES (#{sl_id}, #{sl_pw}, #{sl_name}, #{sl_zip}, #{sl_adr1}, #{sl_adr2}, #{sl_phone}, #{sl_birth}, #{sl_number}, #{sl_bank}, #{sl_bankcode})
    </insert>

    <select id="progCountDay" parameterType="java.lang.String" resultType="java.util.Map">
        select tbc.dt_prog, ifnull(cnt, 0) as ct
        from (
                 select dt.dt_prog, dt.ss_num, sl_id, count(*) as cnt, od_date
                 from tb_order od join tb_detail dt
                                       on od.od_num = dt.od_num join tb_sales sl
                                                                     on dt.ss_num = sl.ss_num
                 where DATE_FORMAT(od_date, '%Y-%m-%d') = DATE_FORMAT(now(), '%Y-%m-%d') and sl_id = #{sl_id}
                 group by dt_prog
             ) tba right join (select *
                               from (
                                        select 'J01' dt_prog from dual union all
                                        select 'J02' dt_prog from dual union all
                                        select 'J03' dt_prog from dual union all
                                        select 'J04' dt_prog from dual union all
                                        select 'J05' dt_prog from dual union all
                                        select 'J06' dt_prog from dual union all
                                        select 'J07' dt_prog from dual union all
                                        select 'J08' dt_prog from dual
                                    ) tbb
        ) tbc on tba.dt_prog = tbc.dt_prog
    </select>
    
    <select id="progCountAll" parameterType="java.lang.String" resultType="java.util.Map">
        select tbc.dt_prog, ifnull(cnt, 0) as ct
        from (
                 select dt_prog, count(*) as cnt, dt.ss_num, sl.sl_id
                 from tb_detail dt join tb_sales sl
                                        on dt.ss_num = sl.ss_num join tb_order od
                                                                      on dt.od_num = od.od_num
                 where sl_id = #{sl_id}
                 group by dt_prog
                 order by dt_prog
             ) tba right join (select *
                               from (
                                        select 'J01' dt_prog from dual union all
                                        select 'J02' dt_prog from dual union all
                                        select 'J03' dt_prog from dual union all
                                        select 'J04' dt_prog from dual union all
                                        select 'J05' dt_prog from dual union all
                                        select 'J06' dt_prog from dual union all
                                        select 'J07' dt_prog from dual union all
                                        select 'J08' dt_prog from dual
                                    ) tbb
        ) tbc on tba.dt_prog = tbc.dt_prog
    </select>


</mapper>